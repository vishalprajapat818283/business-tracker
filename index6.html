<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Business Activity Tracker - Pro</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f7fb;
    }
    header {
      background: #1f2937;
      color: #fff;
      padding: 15px 20px;
      text-align: center;
      position: relative;
    }
    .container {
      max-width: 1100px;
      margin: 20px auto;
      padding: 0 15px;
    }
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    .tab-btn {
      border: none;
      background: #e5e7eb;
      padding: 8px 14px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    .tab-btn.active {
      background: #2563eb;
      color: #fff;
    }
    section {
      display: none;
      background: #fff;
      border-radius: 6px;
      padding: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.08);
      margin-bottom: 20px;
    }
    section.active {
      display: block;
    }
    h2 {
      margin-top: 0;
      font-size: 18px;
      color: #111827;
      border-bottom: 2px solid #f3f4f6;
      padding-bottom: 10px;
      margin-bottom: 15px;
    }
    form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 10px;
      margin-bottom: 15px;
      align-items: end;
    }
    label {
      font-size: 13px;
      color: #374151;
      display: block;
      margin-bottom: 3px;
    }
    input {
      width: 100%;
      padding: 8px;
      font-size: 14px;
      border-radius: 4px;
      border: 1px solid #d1d5db;
      box-sizing: border-box;
    }
    .btn {
      padding: 8px 12px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      font-size: 14px;
    }
    .btn-primary { background: #2563eb; color: #fff; }
    .btn-danger { background: #dc2626; color: #fff; }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 5px;
      font-size: 13px;
    }
    th, td {
      border: 1px solid #e5e7eb;
      padding: 10px 8px;
      text-align: left;
    }
    th { background: #f3f4f6; color: #374151; }
    
    /* DASHBOARD CARDS */
    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }
    .card {
      background: #fff;
      border-radius: 8px;
      padding: 15px;
      border: 1px solid #e5e7eb;
      text-align: center;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .card-title { font-size: 12px; text-transform: uppercase; color: #6b7280; letter-spacing: 0.5px; margin-bottom: 8px; }
    .card-value { font-size: 22px; color: #111827; font-weight: bold; }
    .profit { color: #16a34a; }
    .loss { color: #dc2626; }

    /* AUTH STYLES */
    .auth-container {
      max-width: 400px;
      margin: 60px auto;
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    .auth-toggle { text-align: center; margin-top: 15px; font-size: 14px; color: #2563eb; cursor: pointer; }
    .error-msg { color: #dc2626; font-size: 13px; margin-top: 10px; display: none; text-align: center; }
  </style>
</head>
<body>

  <div id="authSection" class="auth-container">
    <h1 style="text-align:center; margin-bottom:20px;">ðŸ“Š Business Tracker</h1>
    <div id="loginForm">
      <label>Email</label>
      <input type="email" id="loginEmail" style="margin-bottom:15px;">
      <label>Password</label>
      <input type="password" id="loginPass" style="margin-bottom:20px;">
      <button class="btn btn-primary" style="width:100%" onclick="login()">Login</button>
      <p class="auth-toggle" onclick="toggleAuth(true)">Create a new account</p>
    </div>
    <div id="registerForm" style="display:none;">
      <label>Full Name</label><input type="text" id="regName" style="margin-bottom:10px;">
      <label>Company Name</label><input type="text" id="regCompany" style="margin-bottom:10px;">
      <label>Email</label><input type="email" id="regEmail" style="margin-bottom:10px;">
      <label>Password</label><input type="password" id="regPass" style="margin-bottom:15px;">
      <button class="btn btn-primary" style="width:100%" onclick="register()">Create Account</button>
      <p class="auth-toggle" onclick="toggleAuth(false)">Back to Login</p>
    </div>
    <div id="authError" class="error-msg"></div>
  </div>

  <header id="mainHeader" style="display:none;">
    <h1 id="companyTitle">Company Name</h1>
    <p id="ownerLine">Welcome</p>
    <button class="btn btn-danger" style="position:absolute; right:20px; top:20px;" onclick="logout()">Logout</button>
  </header>

  <div class="container" id="mainApp" style="display:none;">
    <div class="tabs">
      <button class="tab-btn active" data-target="dashboard">Dashboard</button>
      <button class="tab-btn" data-target="rawMaterial">Raw Material</button>
      <button class="tab-btn" data-target="production">Production</button>
      <button class="tab-btn" data-target="sales">Sales</button>
    </div>

    <section id="dashboard" class="active">
      <h2>Live Business Summary</h2>
      <div class="cards">
        <div class="card"><div class="card-title">Net Profit/Loss</div><div class="card-value" id="dashProfitLoss">â‚¹0</div></div>
        <div class="card"><div class="card-title">Total Sales Amount</div><div class="card-value" id="dashSalesAmount">â‚¹0</div></div>
        <div class="card"><div class="card-title">Total Raw Expenses</div><div class="card-value" id="dashRawCost">â‚¹0</div></div>
        <div class="card"><div class="card-title">Sales Entries</div><div class="card-value" id="dashSaleCount">0</div></div>
        <div class="card"><div class="card-title">Production Entries</div><div class="card-value" id="dashProdCount">0</div></div>
        <div class="card"><div class="card-title">Raw Entries</div><div class="card-value" id="dashRawCount">0</div></div>
      </div>
      
      <h3>Product Stock Remains</h3>
      <table id="stockTable">
        <thead>
          <tr><th>Item Name</th><th>Total Produced</th><th>Total Sold</th><th>Remains</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <section id="rawMaterial">
      <h2>Raw Material Inward</h2>
      <form id="rawForm">
        <div><label>Date</label><input type="date" id="rawDate" required></div>
        <div><label>Material Name</label><input type="text" id="rawName" required></div>
        <div><label>Quantity</label><input type="number" id="rawQty" step="0.01" required></div>
        <div><label>Total Cost (â‚¹)</label><input type="number" id="rawCost" step="0.01" required></div>
        <button type="submit" class="btn btn-primary">Save Entry</button>
      </form>
      <table id="rawTable">
        <thead><tr><th>Date</th><th>Material</th><th>Qty</th><th>Cost</th><th>Action</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <section id="production">
      <h2>Production Output</h2>
      <form id="prodForm">
        <div><label>Date</label><input type="date" id="prodDate" required></div>
        <div><label>Product Name</label><input type="text" id="prodItem" required></div>
        <div><label>Qty Produced</label><input type="number" id="prodQty" step="0.01" required></div>
        <div><label>Notes</label><input type="text" id="prodNotes"></div>
        <button type="submit" class="btn btn-primary">Save Entry</button>
      </form>
      <table id="prodTable">
        <thead><tr><th>Date</th><th>Product</th><th>Qty</th><th>Notes</th><th>Action</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <section id="sales">
      <h2>Sales Record</h2>
      <form id="saleForm">
        <div><label>Date</label><input type="date" id="saleDate" required></div>
        <div><label>Product Name</label><input type="text" id="saleItem" required></div>
        <div><label>Qty Sold</label><input type="number" id="saleQty" step="0.01" required></div>
        <div><label>Total Sale (â‚¹)</label><input type="number" id="saleAmount" step="0.01" required></div>
        <button type="submit" class="btn btn-primary">Save Sale</button>
      </form>
      <table id="saleTable">
        <thead><tr><th>Date</th><th>Product</th><th>Qty</th><th>Amount</th><th>Action</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>
  </div>

  <script>
    let currentUser = null;

    function toggleAuth(isReg) {
      document.getElementById('loginForm').style.display = isReg ? 'none' : 'block';
      document.getElementById('registerForm').style.display = isReg ? 'block' : 'none';
      document.getElementById('authError').style.display = 'none';
    }

    function register() {
      const name = document.getElementById('regName').value;
      const company = document.getElementById('regCompany').value;
      const email = document.getElementById('regEmail').value;
      const pass = document.getElementById('regPass').value;
      if(!name || !company || !email || !pass) return showError("Fill all fields");
      if(localStorage.getItem(email)) return showError("User exists");
      localStorage.setItem(email, JSON.stringify({ name, company, email, pass, raw: [], prod: [], sale: [] }));
      alert("Account created!"); toggleAuth(false);
    }

    function login() {
      const email = document.getElementById('loginEmail').value;
      const pass = document.getElementById('loginPass').value;
      const data = JSON.parse(localStorage.getItem(email));
      if(!data || data.pass !== pass) return showError("Invalid credentials");
      currentUser = data; startApp();
    }

    function logout() { location.reload(); }
    function showError(msg) { const e = document.getElementById('authError'); e.textContent = msg; e.style.display = 'block'; }

    function startApp() {
      document.getElementById('authSection').style.display = 'none';
      document.getElementById('mainHeader').style.display = 'block';
      document.getElementById('mainApp').style.display = 'block';
      document.getElementById('companyTitle').textContent = currentUser.company + " Tracker";
      document.getElementById('ownerLine').textContent = "Operator: " + currentUser.name;
      renderAll();
    }

    function save() {
      localStorage.setItem(currentUser.email, JSON.stringify(currentUser));
      renderAll();
    }

    document.querySelectorAll(".tab-btn").forEach(btn => {
      btn.onclick = () => {
        document.querySelectorAll(".tab-btn, section").forEach(el => el.classList.remove("active"));
        btn.classList.add("active");
        document.getElementById(btn.dataset.target).classList.add("active");
      }
    });

    document.getElementById("rawForm").onsubmit = (e) => {
      e.preventDefault();
      currentUser.raw.push({ id: Date.now(), date: rawDate.value, name: rawName.value, qty: +rawQty.value, cost: +rawCost.value });
      e.target.reset(); save();
    };

    document.getElementById("prodForm").onsubmit = (e) => {
      e.preventDefault();
      currentUser.prod.push({ id: Date.now(), date: prodDate.value, item: prodItem.value, qty: +prodQty.value, notes: prodNotes.value });
      e.target.reset(); save();
    };

    document.getElementById("saleForm").onsubmit = (e) => {
      e.preventDefault();
      currentUser.sale.push({ id: Date.now(), date: saleDate.value, item: saleItem.value, qty: +saleQty.value, amount: +saleAmount.value });
      e.target.reset(); save();
    };

    function deleteItem(type, id) {
      currentUser[type] = currentUser[type].filter(i => i.id !== id);
      save();
    }

    function renderAll() {
      // Clear and Render Tables
      document.querySelector("#rawTable tbody").innerHTML = currentUser.raw.map(r => `<tr><td>${r.date}</td><td>${r.name}</td><td>${r.qty}</td><td>â‚¹${r.cost}</td><td><button class="btn btn-danger" onclick="deleteItem('raw', ${r.id})">Del</button></td></tr>`).join('');
      document.querySelector("#prodTable tbody").innerHTML = currentUser.prod.map(p => `<tr><td>${p.date}</td><td>${p.item}</td><td>${p.qty}</td><td>${p.notes}</td><td><button class="btn btn-danger" onclick="deleteItem('prod', ${p.id})">Del</button></td></tr>`).join('');
      document.querySelector("#saleTable tbody").innerHTML = currentUser.sale.map(s => `<tr><td>${s.date}</td><td>${s.item}</td><td>${s.qty}</td><td>â‚¹${s.amount}</td><td><button class="btn btn-danger" onclick="deleteItem('sale', ${s.id})">Del</button></td></tr>`).join('');

      // Stock Remains Logic
      const stocks = {};
      currentUser.prod.forEach(p => { 
        const n = p.item.toLowerCase().trim(); 
        if(!stocks[n]) stocks[n] = { name: p.item, p: 0, s: 0 }; 
        stocks[n].p += p.qty; 
      });
      currentUser.sale.forEach(s => { 
        const n = s.item.toLowerCase().trim(); 
        if(!stocks[n]) stocks[n] = { name: s.item, p: 0, s: 0 }; 
        stocks[n].s += s.qty; 
      });
      document.querySelector("#stockTable tbody").innerHTML = Object.values(stocks).map(st => `<tr><td>${st.name}</td><td>${st.p}</td><td>${st.s}</td><td style="font-weight:bold; color:${(st.p-st.s) < 0 ? 'red' : 'green'}">${st.p-st.s}</td></tr>`).join('');

      // Update Dashboard Totals
      const rawCost = currentUser.raw.reduce((s, r) => s + r.cost, 0);
      const saleAmt = currentUser.sale.reduce((s, r) => s + r.amount, 0);
      document.getElementById('dashRawCost').textContent = "â‚¹" + rawCost.toFixed(2);
      document.getElementById('dashSalesAmount').textContent = "â‚¹" + saleAmt.toFixed(2);
      document.getElementById('dashProfitLoss').textContent = "â‚¹" + (saleAmt - rawCost).toFixed(2);
      document.getElementById('dashProfitLoss').className = 'card-value ' + (saleAmt - rawCost >= 0 ? 'profit' : 'loss');
      document.getElementById('dashRawCount').textContent = currentUser.raw.length;
      document.getElementById('dashProdCount').textContent = currentUser.prod.length;
      document.getElementById('dashSaleCount').textContent = currentUser.sale.length;
    }
  </script>
</body>
</html>